"use strict";(self["webpackChunkmenu"]=self["webpackChunkmenu"]||[]).push([[631],{2631:function(e,a,t){t.r(a),t.d(a,{default:function(){return c}});var l=t(6768);const r={class:"header"};function o(e,a,t,o,s,i){const n=(0,l.g2)("el-input"),p=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-radio-button"),d=(0,l.g2)("el-radio-group"),c=(0,l.g2)("el-divider"),h=(0,l.g2)("el-text"),m=(0,l.g2)("el-icon"),g=(0,l.g2)("el-button"),b=(0,l.g2)("AddPartView"),f=(0,l.g2)("el-table-column"),y=(0,l.g2)("el-input-number"),w=(0,l.g2)("el-option"),k=(0,l.g2)("el-select"),_=(0,l.g2)("el-table"),x=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(x,{model:s.form,"label-width":"120px"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{label:"入库单号"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{modelValue:s.form.orderNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.orderNumber=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"入库类型"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:s.form.entryType,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.entryType=e)},{default:(0,l.k6)((()=>[(0,l.bF)(u,{label:"采购入库"}),(0,l.bF)(u,{label:"外协入库"}),(0,l.bF)(u,{label:"退货入库"})])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"供应商",required:"",class:"short-input"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{modelValue:s.form.supplier,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.supplier=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"备注"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{type:"textarea",modelValue:s.form.note,"onUpdate:modelValue":a[3]||(a[3]=e=>s.form.note=e),maxlength:"100","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(c),(0,l.Lk)("div",r,[(0,l.bF)(h,{size:"large",class:"header-text"},{default:(0,l.k6)((()=>[(0,l.eW)("零件明细")])),_:1}),(0,l.bF)(g,{type:"success",plain:"",class:"header-button"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{color:"green"}),(0,l.eW)(" 批量设置仓库/库区 ")])),_:1}),(0,l.bF)(g,{type:"primary",onClick:i.addPart,class:"header-button"},{default:(0,l.k6)((()=>[(0,l.eW)("添加零件")])),_:1},8,["onClick"]),s.Visiable?((0,l.uX)(),(0,l.Wv)(b,{key:0,ref:"dialog",onConfirmParts:i.handleConfirmParts,onClose:a[4]||(a[4]=e=>s.Visiable=!1)},null,8,["onConfirmParts"])):(0,l.Q3)("",!0)]),(0,l.bF)(_,{data:s.form.parts},{default:(0,l.k6)((()=>[(0,l.bF)(f,{prop:"partNumber",label:"零件号",style:{"text-align":"center"}}),(0,l.bF)(f,{label:"入库数量",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(y,{modelValue:e.row.expInNum,"onUpdate:modelValue":a=>e.row.expInNum=a,min:1,class:"box",onChange:a=>i.handleQuantityChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(f,{label:"箱数",class:"titile",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(y,{modelValue:e.row.boxes,"onUpdate:modelValue":a=>e.row.boxes=a,min:1,class:"box",onChange:a=>i.handleBoxCountChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(f,{prop:"waitingPackage",label:"待转包",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(k,{modelValue:e.row.waitingPackage,"onUpdate:modelValue":a=>e.row.waitingPackage=a,placeholder:"请选择",class:"box"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.options,(e=>((0,l.uX)(),(0,l.Wv)(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(f,{prop:"wrapId",label:"器具编码",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(k,{modelValue:e.row.wrapId,"onUpdate:modelValue":a=>e.row.wrapId=a,placeholder:"请选择器具"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.Appliances,(e=>((0,l.uX)(),(0,l.Wv)(w,{key:e.wrapId,label:e.wrapId,value:e.wrapId},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(f,{label:"包装容量",class:"titile"},{default:(0,l.k6)((e=>[(0,l.bF)(y,{modelValue:e.row.wrapSize,"onUpdate:modelValue":a=>e.row.wrapSize=a,min:1},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(f,{label:"操作",class:"titile",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(g,{type:"danger",icon:"el-icon-delete",size:"small",onClick:a=>i.removePart(e.$index),style:{"text-align":"center",height:"40px",width:"139px"}},{default:(0,l.k6)((()=>[(0,l.eW)("删除")])),_:2},1032,["onClick"])])),_:1}),(0,l.bF)(f,{prop:"warehouseArea",label:"仓库/库区",class:"titile"})])),_:1},8,["data"]),(0,l.bF)(p,{class:"savebutton",style:{"text-align":"center"}},{default:(0,l.k6)((()=>[(0,l.bF)(g,{type:"primary",onClick:i.save,style:{"margin-left":"auto","margin-right":"20px"}},{default:(0,l.k6)((()=>[(0,l.eW)("保存")])),_:1},8,["onClick"]),(0,l.bF)(g,{onClick:i.cancel,style:{"margin-left":"0px","margin-right":"auto"}},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])}t(4114);var s=t(9161),i=t(1620),n=t(4373),p={components:{AddPartView:s.A},name:"InventoryForm",data(){return{Visiable:!1,form:{orderNumber:"",entryType:"采购入库",supplier:"",orderID:"",note:"",parts:[]},res_data1:null,res_data2:null,options:[{value:"true",label:"是"},{value:"false",label:"否"}],Appliances:[]}},created(){this.res_data1=this.$route.query.id,this.res_data2=this.$route.query.supplier,this.form.orderNumber=this.res_data1,this.form.supplier=this.res_data2,this.fetchData(),this.fetchAppliances()},methods:{async fetchData(){try{const e=await(0,i.Yz)({listNum:this.form.orderNumber});e?(this.form.supplier=e.supplier||"",console.log(this.form.supplier),this.form.orderNumber=e.listNum||"",console.log(this.form.orderNumber),this.form.parts=(e.wrapInfoDetails||[]).map((e=>({partNumber:e.supId,expInNum:e.expInNum,boxes:e.boxes,wrapId:e.wrapId,wrapSize:e.wrapSize,waitingPackage:"OPEN"===e.status?"true":"false"}))),console.log(this.form.parts)):(console.error("Invalid response data:",e),console.log())}catch(e){console.error("Error fetching data:",e)}},async fetchAppliances(){try{const e=await n.A.post("http://97.64.20.181:8000/request_all_appliances",{});e.data&&Array.isArray(e.data)?this.Appliances=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}console.log(this.Appliances)},getMaxPackageSize(e){console.log(e),console.log(this.Appliances);const a=this.Appliances.find((a=>a.wrapId===e));return a?a.wrapSize:1/0},handlePackageSizeChange(e){const a=this.Appliances.find((a=>a.wrapId===e.wrapId));a&&e.packageSize>a.wrapSize&&(e.packageSize=1)},handleQuantityChange(e){e.wrapSize=Math.ceil(e.expInNum/e.boxes)},handleBoxCountChange(e){e.wrapSize=Math.ceil(e.expInNum/e.boxes)},removePart(e){this.form.parts.splice(e,1)},async save(){console.log("Form data:",this.form.parts);let e={sup_id:"",enstore_num:"",wrap_id:"",wrap_size:"",boxes:""},a=[];console.log("parts:",this.form.parts);for(let r=0;r<this.form.parts.length;r++){if(e.sup_id=this.form.parts[r].partNumber,e.enstore_num=this.form.parts[r].expInNum,e.wrap_id=this.form.parts[r].wrapId,console.log("warpId",this.form.parts[r].wrapId),e.wrap_size=this.form.parts[r].wrapSize,console.log("this.getMaxPackageSize(this.form.parts[i].wrapId)",this.getMaxPackageSize(this.form.parts[r].wrapId)),this.form.parts[r].wrapSize>this.getMaxPackageSize(this.form.parts[r].wrapId))return alert("超过容量上限 "+this.getMaxPackageSize(this.form.parts[r].wrapId)),void this.removePart(r);e.boxes=this.form.parts[r].boxes,a.push(Object.assign({},e))}let t={listNum:this.form.orderNumber,listStatus:"OPEN",supplier:this.form.supplier,wrapInfoDetails:a};console.log(t),console.log("message:",t);try{const e=await n.A.post("http://97.64.20.181:8000/modify_enstore_list/update_supplement",t);e.data?console.log(e.data):console.error("Unexpected response data:",e.data)}catch(l){console.error("Error fetching supplier list:",l)}this.$router.replace("/move/enter/try/enter")},addPart(){this.Visiable=!0},handleConfirmParts(e){e.forEach((e=>{this.form.parts.push({partNumber:e.supId,quantity:1,boxCount:"",waitingPackage:"",toolCode:"",packageSize:1,warehouseArea:""})})),this.Visiable=!1},cancel(){console.log("取消"),this.$router.replace("/move/enter/try/enter")}}},u=t(1241);const d=(0,u.A)(p,[["render",o],["__scopeId","data-v-4c4985b1"]]);var c=d},9161:function(e,a,t){t.d(a,{A:function(){return m}});var l=t(6768);const r={class:"inputArea"},o={style:{display:"flex","justify-content":"center"}},s={style:{display:"flex","justify-content":"center","margin-bottom":"20px"}},i={class:"dialog-footer"};function n(e,a,t,n,p,u){const d=(0,l.g2)("el-text"),c=(0,l.g2)("el-input"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-table-column"),g=(0,l.g2)("el-table"),b=(0,l.g2)("el-pagination"),f=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(f,{modelValue:p.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>p.dialogVisible=e),title:"添加零件",width:"60%"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",r,[(0,l.bF)(d,{class:"inputTitle",tag:"b"},{default:(0,l.k6)((()=>[(0,l.eW)("供应商")])),_:1}),(0,l.bF)(c,{modelValue:p.query.supplier,"onUpdate:modelValue":a[0]||(a[0]=e=>p.query.supplier=e),placeholder:"代码",class:"filter-input",clearable:"",autosize:"",type:"textarea",onClear:u.handleClear,onInput:u.handleInput},null,8,["modelValue","onClear","onInput"]),(0,l.bF)(d,{class:"inputTitle",tag:"b"},{default:(0,l.k6)((()=>[(0,l.eW)("零件号")])),_:1}),(0,l.bF)(c,{modelValue:p.query.supId,"onUpdate:modelValue":a[1]||(a[1]=e=>p.query.supId=e),placeholder:"批量查询",class:"filter-input",clearable:"",autosize:"",type:"textarea",onClear:u.handleClear,onInput:u.handleInput},null,8,["modelValue","onClear","onInput"]),(0,l.bF)(h,{type:"primary",onClick:u.handleQuery},{default:(0,l.k6)((()=>[(0,l.eW)("查询")])),_:1},8,["onClick"])]),(0,l.Lk)("div",o,[(0,l.bF)(g,{data:u.filteredData,border:"",style:{width:"70%","margin-bottom":"20px"},onSelectionChange:u.handleSelectionChange},{default:(0,l.k6)((()=>[(0,l.bF)(m,{type:"selection",width:"70"}),(0,l.bF)(m,{prop:"supName",label:"零件名称"}),(0,l.bF)(m,{prop:"supId",label:"零件编号"}),(0,l.bF)(m,{prop:"supplier",label:"供应商"})])),_:1},8,["data","onSelectionChange"])]),(0,l.Lk)("div",s,[(0,l.bF)(b,{background:"",layout:"prev, pager, next",total:p.total,"page-size":p.pageSize,onCurrentChange:u.handlePageChange},null,8,["total","page-size","onCurrentChange"])]),(0,l.Lk)("span",i,[(0,l.Lk)("div",null,[(0,l.RG)(e.$slots,"footer",{},void 0,!0)]),(0,l.bF)(h,{onClick:a[2]||(a[2]=e=>p.dialogVisible=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:u.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:3},8,["modelValue"])}var p=t(4373),u=t(1620),d={name:"AddPartView",data(){return{dialogVisible:!0,supplier:null,query:{supplier:"",supId:""},selectedParts:[],parts:[],currentPage:1,pageSize:10,total:0}},created(){this.fetchSupplementList()},computed:{filteredData(){const e=Array.isArray(this.parts)?this.parts:[];return this.query?e.filter((e=>e.supId&&e.supId.includes(this.query.supId)&&e.supplier&&e.supplier.includes(this.query.supplier))):e.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)}},watch:{parts(e){this.total=Array.isArray(e)?e.length:0}},methods:{handleClear(){this.query="",this.currentPage=1},handleInput(){this.currentPage=1},handleQuery(){this.currentPage=1,this.get_supplement_list_filtered()},handleSelectionChange(e){this.selectedParts=e},handlePageChange(e){this.currentPage=e},handleConfirm(){this.$emit("confirmParts",this.selectedParts),this.dialogVisible=!1,console.log(this.selectedParts)},async get_supplement_list_filtered(){let e={supId:this.query.supId||null,supplier:this.query.supplier||null};try{const a=await(0,u.aM)(e);Array.isArray(a)?this.parts=a:console.error("Unexpected response data:",a)}catch(a){console.error("Error fetching filtered list:",a)}},async fetchSupplementList(){try{const e=await p.A.post("http://97.64.20.181:8000/request_supplement_list",{supId:null,supplier:null});e.data&&Array.isArray(e.data)?this.parts=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}}},mounted(){this.total=Array.isArray(this.parts)?this.parts.length:0,this.get_supplement_list_filtered()}},c=t(1241);const h=(0,c.A)(d,[["render",n],["__scopeId","data-v-07232d6c"]]);var m=h}}]);
//# sourceMappingURL=631.0ca1f632.js.map