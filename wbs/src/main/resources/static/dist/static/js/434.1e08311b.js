"use strict";(self["webpackChunkmenu"]=self["webpackChunkmenu"]||[]).push([[434],{1434:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var l=a(6768);const r={class:"header"};function o(e,t,a,o,s,i){const n=(0,l.g2)("el-input"),u=(0,l.g2)("el-form-item"),d=(0,l.g2)("el-option"),p=(0,l.g2)("el-select"),c=(0,l.g2)("el-divider"),h=(0,l.g2)("el-text"),m=(0,l.g2)("el-icon"),g=(0,l.g2)("el-button"),b=(0,l.g2)("AddSup"),f=(0,l.g2)("el-table-column"),y=(0,l.g2)("el-input-number"),C=(0,l.g2)("el-table"),k=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(k,{model:s.form,"label-width":"120px"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{label:"出库单号"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{modelValue:s.form.orderNumber,"onUpdate:modelValue":t[0]||(t[0]=e=>s.form.orderNumber=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,l.bF)(u,{label:"顾客",required:"",class:"short-input"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{modelValue:s.form.customer,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.customer=e),placeholder:"请选择客户"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.CustomerList,(e=>((0,l.uX)(),(0,l.Wv)(d,{key:e.customerId,label:e.customerName,value:e.customerName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(u,{label:"备注"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{type:"textarea",modelValue:s.form.note,"onUpdate:modelValue":t[2]||(t[2]=e=>s.form.note=e),maxlength:"100","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(c),(0,l.Lk)("div",r,[(0,l.bF)(h,{size:"large",class:"header-text"},{default:(0,l.k6)((()=>[(0,l.eW)("物料明细")])),_:1}),(0,l.bF)(g,{type:"success",plain:"",class:"header-button"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{color:"green"}),(0,l.eW)(" 批量设置仓库/库区 ")])),_:1}),(0,l.bF)(g,{type:"primary",onClick:i.addPart,class:"header-button"},{default:(0,l.k6)((()=>[(0,l.eW)("添加物料")])),_:1},8,["onClick"]),s.Visiable?((0,l.uX)(),(0,l.Wv)(b,{key:0,ref:"dialog",onConfirmParts:i.handleConfirmParts,onClose:t[3]||(t[3]=e=>s.Visiable=!1)},null,8,["onConfirmParts"])):(0,l.Q3)("",!0)]),(0,l.bF)(C,{data:s.form.parts,border:""},{default:(0,l.k6)((()=>[(0,l.bF)(f,{prop:"partNumber",label:"物料号",width:"180",style:{"text-align":"center"}}),(0,l.bF)(f,{prop:"partName",label:"物料名",width:"180",style:{"text-align":"center"}}),(0,l.bF)(f,{label:"计划数量",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(y,{modelValue:e.row.quantity,"onUpdate:modelValue":t=>e.row.quantity=t,min:1,max:e.row.max_quantity,class:"box",onChange:t=>i.handleQuantityChange(e.row)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])])),_:1}),(0,l.bF)(f,{label:"箱数",class:"titile",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(y,{modelValue:e.row.boxCount,"onUpdate:modelValue":t=>e.row.boxCount=t,min:1,class:"box",onChange:t=>i.handleBoxCountChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(f,{prop:"toolCode",label:"器具编码",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(p,{modelValue:e.row.toolCode,"onUpdate:modelValue":t=>e.row.toolCode=t,placeholder:"请选择器具"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.Appliances,(e=>((0,l.uX)(),(0,l.Wv)(d,{key:e.wrapId,label:e.wrapId,value:e.wrapId},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(f,{label:"包装容量",width:"180",class:"titile"},{default:(0,l.k6)((e=>[(0,l.bF)(y,{modelValue:e.row.packageSize,"onUpdate:modelValue":t=>e.row.packageSize=t,min:1},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(f,{label:"操作",class:"titile",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(g,{type:"danger",icon:"el-icon-delete",size:"small",onClick:t=>i.removePart(e.$index),style:{"text-align":"center",height:"40px",width:"139px"}},{default:(0,l.k6)((()=>[(0,l.eW)("删除")])),_:2},1032,["onClick"])])),_:1}),(0,l.bF)(f,{prop:"warehouseArea",label:"仓库/库区",width:"180",class:"titile"})])),_:1},8,["data"]),(0,l.bF)(u,{class:"savebutton",style:{"text-align":"center"}},{default:(0,l.k6)((()=>[(0,l.bF)(g,{type:"primary",onClick:i.save,style:{"margin-left":"auto","margin-right":"20px"}},{default:(0,l.k6)((()=>[(0,l.eW)("保存")])),_:1},8,["onClick"]),(0,l.bF)(g,{onClick:i.cancel,style:{"margin-left":"0px","margin-right":"auto"}},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])}a(4114);var s=a(4373),i=a(5454),n={components:{AddSup:i.A},name:"ShipmentCreate",data(){return{Visiable:!1,form:{orderNumber:"",customer:"",note:"",parts:[]},SupplierList:[],Appliances:[],CustomerList:[]}},created(){this.fetchSupplierList(),this.fetchAppliances(),this.fetchOrderNumber(),this.get_enstorelist_num(),this.fetchCustomer()},methods:{async fetchSupplierList(){try{const e=await s.A.post("http://97.64.20.181:8000/get_supplier_list",{});e.data&&Array.isArray(e.data)?this.SupplierList=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}},async fetchCustomer(){try{const e=await s.A.post("http://97.64.20.181:8000/get_customer_list",{});e.data&&Array.isArray(e.data)?this.CustomerList=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}},async fetchAppliances(){try{const e=await s.A.post("http://97.64.20.181:8000/request_all_appliances",{});e.data&&Array.isArray(e.data)?this.Appliances=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}console.log(this.Appliances)},async fetchOrderNumber(){let e=await this.get_enstorelist_num();const t=e.Num;console.log(e);const a=new Date,l=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,"0"),o=a.getDate().toString().padStart(2,"0"),s=`R-${l}-${r}-${o}-${t}`;this.form.orderNumber=s},async get_enstorelist_num(){let e;return await s.A.post("http://97.64.20.181:8000/get_new_enstore_num_today").then((t=>{e=t.data})),e},handleToolCodeChange(e){const t=this.Appliances.find((t=>t.wrapId===e.toolCode));t&&(e.packageSize=Math.min(e.packageSize,t.wrapSize))},getMaxPackageSize(e){const t=this.Appliances.find((t=>t.wrapId===e));return t?t.wrapSize:1/0},handleQuantityChange(e){e.packageSize=Math.ceil(e.quantity/e.boxCount)},handleBoxCountChange(e){e.packageSize=Math.ceil(e.quantity/e.boxCount)},addPart(){this.Visiable=!0},handleConfirmParts(e){e.forEach((e=>{this.form.parts.push({partNumber:e.supId,partName:e.supName,quantity:1,boxCount:"",waitingPackage:"",toolCode:"",packageSize:1,warehouseArea:"",max_quantity:e.amount})})),this.Visiable=!1},removePart(e){this.form.parts.splice(e,1)},cancel(){this.$router.replace("/move/shipment/ShipmentMain")},async save(){let e={sup_id:"",exstore_num:"",wrap_id:"",wrap_size:"",boxes:""},t=[];console.log("Form data:",this.form),console.log("parts:",this.form.parts);for(let r=0;r<this.form.parts.length;r++){if(e.sup_id=this.form.parts[r].partNumber,e.exstore_num=this.form.parts[r].quantity,e.wrap_id=this.form.parts[r].toolCode,e.wrap_size=this.form.parts[r].packageSize,this.form.parts[r].packageSize>this.getMaxPackageSize(this.form.parts[r].toolCode))return alert("超过容量上限 "+this.getMaxPackageSize(this.form.parts[r].toolCode)),void this.removePart(r);e.boxes=this.form.parts[r].boxCount,t.push(Object.assign({},e)),console.log(t)}let a={listNum:this.form.orderNumber,listStatus:"OPEN",customer:this.form.customer,wrapInfoDetails:t};console.log(a);try{const e=await s.A.post("http://97.64.20.181:8000/create_exstore_list",a);e.data?console.log(e.data):console.error("Unexpected response data:",e.data)}catch(l){console.error("Error fetching supplier list:",l)}this.$router.replace("/move/shipment/ShipmentMain")}}},u=a(1241);const d=(0,u.A)(n,[["render",o],["__scopeId","data-v-5aaa0eec"]]);var p=d},5454:function(e,t,a){a.d(t,{A:function(){return m}});var l=a(6768);const r={class:"inputArea"},o={style:{display:"flex","justify-content":"center"}},s={style:{display:"flex","justify-content":"center","margin-bottom":"20px"}},i={class:"dialog-footer"};function n(e,t,a,n,u,d){const p=(0,l.g2)("el-text"),c=(0,l.g2)("el-input"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-table-column"),g=(0,l.g2)("el-table"),b=(0,l.g2)("el-pagination"),f=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(f,{modelValue:u.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>u.dialogVisible=e),title:"添加物料",width:"60%"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",r,[(0,l.bF)(p,{class:"inputTitle",tag:"b"},{default:(0,l.k6)((()=>[(0,l.eW)("供应商")])),_:1}),(0,l.bF)(c,{modelValue:u.query.supplier,"onUpdate:modelValue":t[0]||(t[0]=e=>u.query.supplier=e),placeholder:"代码",class:"filter-input",clearable:"",autosize:"",type:"textarea",onClear:d.handleClear,onInput:d.handleInput},null,8,["modelValue","onClear","onInput"]),(0,l.bF)(p,{class:"inputTitle",tag:"b"},{default:(0,l.k6)((()=>[(0,l.eW)("零件号")])),_:1}),(0,l.bF)(c,{modelValue:u.query.supId,"onUpdate:modelValue":t[1]||(t[1]=e=>u.query.supId=e),placeholder:"批量查询",class:"filter-input",clearable:"",autosize:"",type:"textarea",onClear:d.handleClear,onInput:d.handleInput},null,8,["modelValue","onClear","onInput"]),(0,l.bF)(h,{type:"primary",onClick:d.handleQuery},{default:(0,l.k6)((()=>[(0,l.eW)("查询")])),_:1},8,["onClick"])]),(0,l.Lk)("div",o,[(0,l.bF)(g,{data:d.filteredData,border:"",style:{width:"70%","margin-bottom":"20px"},onSelectionChange:d.handleSelectionChange},{default:(0,l.k6)((()=>[(0,l.bF)(m,{type:"selection",width:"70"}),(0,l.bF)(m,{prop:"supName",label:"零件名称"}),(0,l.bF)(m,{prop:"supId",label:"零件编号"}),(0,l.bF)(m,{prop:"supplier",label:"供应商"}),(0,l.bF)(m,{prop:"amount",label:"数量"})])),_:1},8,["data","onSelectionChange"])]),(0,l.Lk)("div",s,[(0,l.bF)(b,{background:"",layout:"prev, pager, next",total:u.total,"page-size":u.pageSize,onCurrentChange:d.handlePageChange},null,8,["total","page-size","onCurrentChange"])]),(0,l.Lk)("span",i,[(0,l.Lk)("div",null,[(0,l.RG)(e.$slots,"footer",{},void 0,!0)]),(0,l.bF)(h,{onClick:t[2]||(t[2]=e=>u.dialogVisible=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:d.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:3},8,["modelValue"])}var u=a(4373),d=a(1620),p={name:"AddSup",data(){return{dialogVisible:!0,supplier:null,query:{supId:"",supplier:""},selectedParts:[],parts:[],currentPage:1,pageSize:10,total:0}},created(){this.fetchStockList()},computed:{filteredData(){const e=Array.isArray(this.parts)?this.parts:[];return this.query?e.filter((e=>e.supId&&e.supId.includes(this.query.supId)&&"Available"==e.available&&e.supplier&&e.supplier.includes(this.query.supplier))):e.filter((e=>"Available"===e.available)).slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)}},watch:{parts(e){this.total=Array.isArray(e)?e.length:0}},methods:{handleClear(){this.query="",this.currentPage=1},handleInput(){this.currentPage=1},handleQuery(){this.currentPage=1,this.get_supplement_list_filtered()},handleSelectionChange(e){this.selectedParts=e},handlePageChange(e){this.currentPage=e},handleConfirm(){this.$emit("confirmParts",this.selectedParts),this.dialogVisible=!1,console.log(this.selectedParts)},async get_supplement_list_filtered(){let e={supId:this.query||null,supplier:this.supplier||null};try{const t=await(0,d.l9)(e);Array.isArray(t)?this.parts=t:console.error("Unexpected response data:",t)}catch(t){console.error("Error fetching filtered list:",t)}},async fetchStockList(){try{const e=await u.A.post("http://97.64.20.181:8000/request_stock",{supId:null,supplier:null});e.data&&Array.isArray(e.data)?(this.parts=e.data,console.log(this.parts)):console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}}},mounted(){this.total=Array.isArray(this.parts)?this.parts.length:0,this.get_supplement_list_filtered()}},c=a(1241);const h=(0,c.A)(p,[["render",n],["__scopeId","data-v-1afd2b18"]]);var m=h}}]);
//# sourceMappingURL=434.1e08311b.js.map