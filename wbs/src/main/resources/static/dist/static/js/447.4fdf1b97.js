"use strict";(self["webpackChunkmenu"]=self["webpackChunkmenu"]||[]).push([[447],{4447:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var l=a(6768),r=a(4232);const i=e=>((0,l.Qi)("data-v-0383f133"),e=e(),(0,l.jt)(),e),s={class:"action-buttons"},o=i((()=>(0,l.Lk)("i",{class:"el-icon-edit"},null,-1))),n=i((()=>(0,l.Lk)("i",{class:"el-icon-download"},null,-1))),u=i((()=>(0,l.Lk)("i",{class:"el-icon-printer"},null,-1))),p=i((()=>(0,l.Lk)("i",{class:"el-icon-document"},null,-1))),d=i((()=>(0,l.Lk)("i",{class:"el-icon-delete"},null,-1))),c={class:"pagination-container"};function m(e,t,a,i,m,b){const g=(0,l.g2)("el-tab-pane"),h=(0,l.g2)("el-tabs"),f=(0,l.g2)("el-input"),k=(0,l.g2)("el-col"),D=(0,l.g2)("el-button"),S=(0,l.g2)("el-row"),N=(0,l.g2)("el-table-column"),y=(0,l.g2)("PrintTemp"),_=(0,l.g2)("el-table"),v=(0,l.g2)("el-pagination");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(h,{modelValue:m.activeTab,"onUpdate:modelValue":t[0]||(t[0]=e=>m.activeTab=e)},{default:(0,l.k6)((()=>[(0,l.bF)(g,{label:"全部",name:"all"}),(0,l.bF)(g,{label:"未发货",name:"not-shipped"}),(0,l.bF)(g,{label:"在途",name:"in-transit"}),(0,l.bF)(g,{label:"部分入库",name:"partial-storage"}),(0,l.bF)(g,{label:"作废",name:"invalid"}),(0,l.bF)(g,{label:"入库完成",name:"completed"})])),_:1},8,["modelValue"]),(0,l.bF)(S,{gutter:20,class:"filter-section"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{span:6},{default:(0,l.k6)((()=>[(0,l.bF)(f,{modelValue:m.filters.supplier,"onUpdate:modelValue":t[1]||(t[1]=e=>m.filters.supplier=e),placeholder:"请输入供应商"},null,8,["modelValue"])])),_:1}),(0,l.bF)(k,{span:6},{default:(0,l.k6)((()=>[(0,l.bF)(f,{modelValue:m.filters.storageNumber,"onUpdate:modelValue":t[2]||(t[2]=e=>m.filters.storageNumber=e),placeholder:"请输入入库单号"},null,8,["modelValue"])])),_:1}),(0,l.bF)(k,{span:6},{default:(0,l.k6)((()=>[(0,l.bF)(D,{type:"primary",onClick:b.search},{default:(0,l.k6)((()=>[(0,l.eW)("搜索")])),_:1},8,["onClick"]),(0,l.bF)(D,{onClick:b.resetFilters},{default:(0,l.k6)((()=>[(0,l.eW)("重置")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,l.bF)(D,{type:"primary",onClick:b.createStorageOrder},{default:(0,l.k6)((()=>[(0,l.eW)("创建入库单")])),_:1},8,["onClick"]),b.paginatedData.length?((0,l.uX)(),(0,l.Wv)(_,{key:0,data:b.paginatedData,style:{width:"100%"},class:"table-section"},{default:(0,l.k6)((()=>[(0,l.bF)(N,{prop:"storageNumber",label:"入库单号"}),(0,l.bF)(N,{prop:"supplier",label:"供应商"}),(0,l.bF)(N,{label:"入库状态"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",{class:(0,r.C4)(b.getStatusClass(e.row.storageStatus))},(0,r.v_)(e.row.storageStatus),3)])),_:1}),(0,l.bF)(N,null,{default:(0,l.k6)((e=>[(0,l.Lk)("div",s,["未发货"===e.row.storageStatus?((0,l.uX)(),(0,l.Wv)(D,{key:0,type:"primary",size:"small",onClick:t=>b.edit(e.row)},{default:(0,l.k6)((()=>[o,(0,l.eW)(" 修改 ")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(D,{type:"primary",size:"small",onClick:t=>b.store(e.row)},{default:(0,l.k6)((()=>[n,(0,l.eW)(" 入库 ")])),_:2},1032,["onClick"]),(0,l.bF)(D,{type:"primary",size:"small",onClick:t=>b.openPrintDialog(e.row.storageNumber)},{default:(0,l.k6)((()=>[u,(0,l.eW)(" 打印入库单 ")])),_:2},1032,["onClick"]),(0,l.bF)(y,{modelValue:m.Visible,"onUpdate:modelValue":t[3]||(t[3]=e=>m.Visible=e),onClose:t[4]||(t[4]=e=>m.Visible=!1),dialogVisible1:m.Visible,listnum:m.listNum},null,8,["modelValue","dialogVisible1","listnum"]),(0,l.bF)(D,{type:"primary",size:"small",onClick:t=>b.printKanban(e.row)},{default:(0,l.k6)((()=>[p,(0,l.eW)(" 打印看板 ")])),_:2},1032,["onClick"]),(e.row.storageStatus,(0,l.uX)(),(0,l.Wv)(D,{key:1,type:"primary",size:"small",onClick:t=>b.deleteRow(e.row)},{default:(0,l.k6)((()=>[d,(0,l.eW)(" 删除 ")])),_:2},1032,["onClick"]))])])),_:1})])),_:1},8,["data"])):(0,l.Q3)("",!0),(0,l.Lk)("div",c,[(0,l.bF)(v,{"current-page":m.currentPage,"onUpdate:currentPage":t[5]||(t[5]=e=>m.currentPage=e),"page-size":m.pageSize,"onUpdate:pageSize":t[6]||(t[6]=e=>m.pageSize=e),small:e.small,disabled:e.disabled,background:e.background,layout:"total,  prev, pager, next, jumper",total:m.filteredData.length,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","small","disabled","background","total","onCurrentChange"])])])}a(4114);var b=a(1620);const g={class:"app-container"},h=(0,l.Lk)("h1",{align:"center"}," 打印预览 ",-1),f={id:"printForm"},k={style:{padding:"20px"},align:"left"},D={style:{margin:"50px 20px"}},S={style:{margin:"50px 20px"}},N={style:{margin:"50px 20px"}},y={align:"center"},_={align:"center",style:{"margin-top":"50px"}};function v(e,t,a,i,s,o){const n=(0,l.g2)("el-table-column"),u=(0,l.g2)("el-table"),p=(0,l.g2)("el-form"),d=(0,l.g2)("el-button"),c=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>s.dialogVisible=e),title:"打印入库单",width:"60%"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",g,[h,(0,l.Lk)("div",f,[(0,l.bF)(p,{ref:s.formRef,model:e.form,rules:s.validateRules},{default:(0,l.k6)((()=>[(0,l.Lk)("div",k,[(0,l.Lk)("span",D,"供应商："+(0,r.v_)(s.tableHeader.Supplier),1),(0,l.Lk)("span",S,"订单号："+(0,r.v_)(s.tableHeader.ListNum),1),(0,l.Lk)("span",N,"日期："+(0,r.v_)(s.tableHeader.Date),1)]),(0,l.Lk)("div",y,[(0,l.bF)(u,{data:s.tableData,style:{width:"95%"},border:""},{default:(0,l.k6)((()=>[(0,l.bF)(n,{prop:"SupplementID",label:"物料ID"}),(0,l.bF)(n,{prop:"SupplementName",label:"物料名"}),(0,l.bF)(n,{prop:"WrapSize",label:"包装容量"}),(0,l.bF)(n,{prop:"EnstoreNum",label:"数量"}),(0,l.bF)(n,{prop:"Boxes",label:"箱数"})])),_:1},8,["data"])])])),_:1},8,["model","rules"])]),(0,l.Lk)("div",_,[(0,l.bF)(d,{type:"info",onClick:t[0]||(t[0]=e=>o.handlePrint(s.printData))},{default:(0,l.k6)((()=>[(0,l.eW)(" 打印 ")])),_:1})])])])),_:1},8,["modelValue"])}var w=a(4856),F=a.n(w),V={props:{dialogVisible1:{type:Boolean,required:!0},listnum:{type:String,required:!0}},data(){return{dialogVisible:this.dialogVisible1,tableData:[],tableHeader:{Supplier:null,ListNum:this.listnum,Date:null},formRef:"form",validateRules:[],printData:{printable:"printForm",header:"application",ignore:["no-print"]}}},watch:{dialogVisible1(e){this.dialogVisible=e,e&&this.get_full_print_detail()},listnum(){this.dialogVisible&&this.get_full_print_detail()}},methods:{handlePrint(e){F()({printable:e.printable,type:e.type||"html",header:e.header,targetStyles:["*"],style:"@page {margin: 0 10mm};",ignoreElements:e.ignore||[],properties:e.properties||null})},async get_full_print_detail(){this.tableData=[],this.tableHeader.ListNum=this.listnum;let e={listNum:this.tableHeader.ListNum},t=await(0,b.HR)(e),a=await(0,b._c)(),l=a.find((e=>e.supplierName==t.supplier));if(!l)return console.error(`Supplier not found for supplier name: ${t.supplier}`),void alert("供应商信息未找到！");this.printData.header="入库单--"+t.supplier+" ["+l.supplierId+"]",this.tableHeader.Supplier=t.supplier+" ["+l.supplierId+"]";const r=new Date;this.tableHeader.Date=r.toLocaleDateString(),this.tableData=[];for(let i in t.wrapInfoDetails){let e={SupplementName:null,SupplementID:null,WrapSize:null,EnstoreNum:null,Boxes:null};e.SupplementID=t.wrapInfoDetails[i].supId,e.WrapSize=t.wrapInfoDetails[i].wrapSize,e.EnstoreNum=t.wrapInfoDetails[i].expInNum,e.Boxes=t.wrapInfoDetails[i].boxes;let a={supId:t.wrapInfoDetails[i].supId},l=await(0,b.ak)(a);l.length>1?alert("物料信息请求失败！"):e.SupplementName=l[0].supName,this.tableData.push(e)}}}},C=a(1241);const L=(0,C.A)(V,[["render",v]]);var I=L,z={name:"InventoryItem",components:{PrintTemp:I},data(){return{listNum:null,Visible:!1,item_total:0,currentPage:1,pageSize:5,activeTab:"all",filters:{orderNumber:"",supplier:"",storageNumber:""},tableData:[],filteredData:[]}},computed:{paginatedData(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredData.slice(e,t)}},watch:{activeTab(){this.search()}},mounted(){this.fetchDataAndSearch();const e=/ResizeObserver loop limit exceeded/;window.addEventListener("error",(t=>{e.test(t.message)&&t.stopImmediatePropagation()}))},methods:{async fetchDataAndSearch(){try{await this.get_enstore_list(),this.search()}catch(e){console.error("Error fetching or searching:",e)}},async get_enstore_list(){try{let e={listNum:null,listStatus:null,supplier:null},t=await(0,b.cN)(e);console.log(t),t=t.map((e=>({id:e.id,storageNumber:e.listNum,storageStatus:e.listStatus,supplier:e.supplier,creator:e.creator,updator:e.updator,createTime:e.createTime,updateTime:e.updateTime}))),this.item_total=t.length;const a={OPEN:"未发货",ONLOAD:"在途",PENDING:"部分入库",DISCARDED:"作废",CLOSED:"入库完成"};t.forEach((e=>{e.storageStatus in a&&(e.storageStatus=a[e.storageStatus])})),console.log(t),this.tableData=t,console.log("this.tableData",this.tableData)}catch(e){console.error(e)}},openPrintDialog(e){this.listNum=e,this.Visible=!0,console.log(this.listNum)},getStatusClass(e){switch(e){case"未发货":return"not-shipped";case"在途":return"in-transit";case"部分入库":return"partial-storage";case"作废":return"invalid";case"入库完成":return"completed";default:return""}},search(){console.log("搜索条件:",this.filters),console.log("this.tableData",this.tableData);let e=this.tableData;"all"!==this.activeTab&&(e=e.filter((e=>{switch(this.activeTab){case"not-shipped":return"未发货"===e.storageStatus;case"in-transit":return"在途"===e.storageStatus;case"partial-storage":return"部分入库"===e.storageStatus;case"invalid":return"作废"===e.storageStatus;case"completed":return"入库完成"===e.storageStatus;default:return!0}}))),this.filters.orderNumber&&(e=e.filter((e=>e.orderNumber.includes(this.filters.orderNumber)))),this.filters.supplier&&(e=e.filter((e=>e.supplier.includes(this.filters.supplier)))),this.filters.storageNumber&&(e=e.filter((e=>e.storageNumber.includes(this.filters.storageNumber)))),this.filteredData=e},resetFilters(){this.filters.orderNumber="",this.filters.supplier="",this.filters.storageNumber="",this.search()},createStorageOrder(){console.log("创建入库单"),this.$router.push("/move/enter/try/InventoryForm")},edit(e){"未发货"===e.storageStatus?this.$router.push({name:"edit",query:{id:e.storageNumber,supplier:e.supplier}}):console.warn("只有未发货状态的入库单可以编辑")},store(e){console.log("入库:",e),this.$router.push({name:"real_enter",query:{id:e.storageNumber,supplier:e.supplier}})},printOrder(e){console.log("打印入库单:",e),this.Visiable=!0,console.log(this.Visiable)},printKanban(e){console.log("打印看板:",e),console.log(this.Visiable)},async deleteRow(e){this.tableData=this.tableData.filter((t=>t!==e)),console.log("row.storageNumber",e.storageNumber);try{let t={listNum:e.storageNumber},a=await(0,b.zr)(t);console.log(a)}catch(t){console.error(t)}console.log(1111111111),this.search(),console.log("删除:",e)}}};const W=(0,C.A)(z,[["render",m],["__scopeId","data-v-0383f133"]]);var x=W}}]);
//# sourceMappingURL=447.4fdf1b97.js.map