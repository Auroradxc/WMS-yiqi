"use strict";(self["webpackChunkmenu"]=self["webpackChunkmenu"]||[]).push([[26],{3026:function(e,t,l){l.r(t),l.d(t,{default:function(){return P}});var a=l(6768),r=l(4232);const i=e=>((0,a.Qi)("data-v-1b40dc50"),e=e(),(0,a.jt)(),e),s={class:"action-buttons"},o=i((()=>(0,a.Lk)("i",{class:"el-icon-edit"},null,-1))),n=i((()=>(0,a.Lk)("i",{class:"el-icon-delete"},null,-1))),u=i((()=>(0,a.Lk)("i",{class:"el-icon-download"},null,-1))),d=i((()=>(0,a.Lk)("i",{class:"el-icon-printer"},null,-1))),c={class:"pagination-container"};function p(e,t,l,i,p,m){const b=(0,a.g2)("el-tab-pane"),g=(0,a.g2)("el-tabs"),h=(0,a.g2)("el-input"),y=(0,a.g2)("el-col"),f=(0,a.g2)("el-button"),v=(0,a.g2)("el-row"),k=(0,a.g2)("el-table-column"),D=(0,a.g2)("PrintItem"),S=(0,a.g2)("el-table"),_=(0,a.g2)("el-pagination");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(g,{modelValue:p.activeTab,"onUpdate:modelValue":t[0]||(t[0]=e=>p.activeTab=e)},{default:(0,a.k6)((()=>[(0,a.bF)(b,{label:"全部",name:"all"}),(0,a.bF)(b,{label:"未发货",name:"not-shipped"}),(0,a.bF)(b,{label:"已发货",name:"in-transit"}),(0,a.bF)(b,{label:"部分发货",name:"partial-storage"}),(0,a.bF)(b,{label:"作废",name:"invalid"})])),_:1},8,["modelValue"]),(0,a.bF)(v,{gutter:20,class:"filter-section"},{default:(0,a.k6)((()=>[(0,a.bF)(y,{span:6},{default:(0,a.k6)((()=>[(0,a.bF)(h,{modelValue:p.filters.customer,"onUpdate:modelValue":t[1]||(t[1]=e=>p.filters.customer=e),placeholder:"请输入客户"},null,8,["modelValue"])])),_:1}),(0,a.bF)(y,{span:6,style:{"margin-left":"40px"}},{default:(0,a.k6)((()=>[(0,a.bF)(h,{modelValue:p.filters.deliveryNumber,"onUpdate:modelValue":t[2]||(t[2]=e=>p.filters.deliveryNumber=e),placeholder:"请输入出库单号"},null,8,["modelValue"])])),_:1}),(0,a.bF)(y,{span:6,style:{"margin-left":"40px"}},{default:(0,a.k6)((()=>[(0,a.bF)(f,{type:"primary",onClick:m.search},{default:(0,a.k6)((()=>[(0,a.eW)("搜索")])),_:1},8,["onClick"]),(0,a.bF)(f,{onClick:m.resetFilters},{default:(0,a.k6)((()=>[(0,a.eW)("重置")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,a.bF)(f,{type:"primary",onClick:m.createDeliverOrder},{default:(0,a.k6)((()=>[(0,a.eW)("创建出库单")])),_:1},8,["onClick"]),m.paginatedData.length?((0,a.uX)(),(0,a.Wv)(S,{key:0,data:m.paginatedData,style:{width:"100%"},class:"table-section"},{default:(0,a.k6)((()=>[(0,a.bF)(k,{prop:"deliveryNumber",label:"出库单号"}),(0,a.bF)(k,{prop:"customer",label:"客户"}),(0,a.bF)(k,{label:"出库状态"},{default:(0,a.k6)((e=>[(0,a.Lk)("span",{class:(0,r.C4)(m.getStatusClass(e.row.deliveryStatus))},(0,r.v_)(e.row.deliveryStatus),3)])),_:1}),(0,a.bF)(k,{label:"备注"}),(0,a.bF)(k,null,{default:(0,a.k6)((e=>[(0,a.Lk)("div",s,[(e.row.deliveryStatus,(0,a.uX)(),(0,a.Wv)(f,{key:0,type:"primary",size:"small",onClick:t=>m.edit(e.row)},{default:(0,a.k6)((()=>[o,(0,a.eW)(" 修改 ")])),_:2},1032,["onClick"])),"未发货"===e.row.deliveryStatus?((0,a.uX)(),(0,a.Wv)(f,{key:1,type:"primary",size:"small",onClick:t=>m.deleteRow(e.row)},{default:(0,a.k6)((()=>[n,(0,a.eW)(" 删除 ")])),_:2},1032,["onClick"])):(0,a.Q3)("",!0),(e.row.deliveryStatus,(0,a.uX)(),(0,a.Wv)(f,{key:2,type:"primary",size:"small",onClick:t=>m.store(e.row)},{default:(0,a.k6)((()=>[u,(0,a.eW)(" 发货/出库 ")])),_:2},1032,["onClick"])),(0,a.bF)(f,{type:"primary",size:"small",onClick:t=>m.printOrder(e.row)},{default:(0,a.k6)((()=>[d,(0,a.eW)(" 打印 ")])),_:2},1032,["onClick"]),(0,a.bF)(D,{modelValue:p.Visible,"onUpdate:modelValue":t[3]||(t[3]=e=>p.Visible=e),onClose:t[4]||(t[4]=e=>p.Visible=!1),dialogVisible1:p.Visible,listnum:p.listNum},null,8,["modelValue","dialogVisible1","listnum"])])])),_:1})])),_:1},8,["data"])):(0,a.Q3)("",!0),(0,a.Lk)("div",c,[(0,a.bF)(_,{"current-page":p.currentPage,"onUpdate:currentPage":t[5]||(t[5]=e=>p.currentPage=e),"page-size":p.pageSize,"onUpdate:pageSize":t[6]||(t[6]=e=>p.pageSize=e),small:e.small,disabled:e.disabled,background:e.background,layout:"total, prev, pager, next, jumper",total:p.filteredData.length,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","small","disabled","background","total","onCurrentChange"])])])}l(4114);var m=l(1620);const b={class:"app-container"},g=(0,a.Lk)("h1",{align:"center"},"打印预览",-1),h={id:"printForm"},y={style:{padding:"20px"},align:"left"},f={style:{margin:"50px 10px"}},v={style:{margin:"50px 10px"}},k={style:{margin:"50px 10px"}},D={style:{margin:"50px 10px"}},S={align:"center"},_={align:"center",style:{"margin-top":"50px"}};function N(e,t,l,i,s,o){const n=(0,a.g2)("el-table-column"),u=(0,a.g2)("el-table"),d=(0,a.g2)("el-form"),c=(0,a.g2)("el-button"),p=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.Wv)(p,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>s.dialogVisible=e),title:"打印出库单",width:"60%"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",b,[g,(0,a.Lk)("div",h,[(0,a.bF)(d,{ref:s.formRef,model:e.form,rules:s.validateRules},{default:(0,a.k6)((()=>[(0,a.Lk)("div",y,[(0,a.Lk)("span",f,"客户："+(0,r.v_)(s.tableHeader.Customer),1),(0,a.Lk)("span",v,"订单号："+(0,r.v_)(s.tableHeader.ListNum),1),(0,a.Lk)("span",k,"出库类型："+(0,r.v_)(s.tableHeader.ExstoreType),1),(0,a.Lk)("span",D,"日期："+(0,r.v_)(s.tableHeader.Date),1)]),(0,a.Lk)("div",S,[(0,a.bF)(u,{data:s.tableData,style:{width:"95%"},border:""},{default:(0,a.k6)((()=>[(0,a.bF)(n,{prop:"SupplementID",label:"物料ID"}),(0,a.bF)(n,{prop:"SupplementName",label:"物料名"}),(0,a.bF)(n,{prop:"WrapSize",label:"包装容量"}),(0,a.bF)(n,{prop:"EnstoreNum",label:"数量"}),(0,a.bF)(n,{prop:"Boxes",label:"箱数"}),(0,a.bF)(n,{prop:"UnloadPlace",label:"卸货地"})])),_:1},8,["data"])])])),_:1},8,["model","rules"])]),(0,a.Lk)("div",_,[(0,a.bF)(c,{type:"info",onClick:t[0]||(t[0]=e=>o.handlePrint(s.printData))},{default:(0,a.k6)((()=>[(0,a.eW)("打印")])),_:1})])])])),_:1},8,["modelValue"])}var F=l(4856),C=l.n(F),w={props:{dialogVisible1:{type:Boolean,required:!0},listnum:{type:String,required:!0}},data(){return{dialogVisible:this.dialogVisible1,tableData:[],tableHeader:{Customer:null,ListNum:this.listnum,ExstoreType:"",Date:null},formRef:"form",validateRules:[],printData:{printable:"printForm",header:"application",ignore:["no-print"]}}},watch:{dialogVisible1(e){this.dialogVisible=e,e&&this.get_full_print_detail()},listnum(){this.dialogVisible&&this.get_full_print_detail()}},methods:{handlePrint(e){C()({printable:e.printable,type:e.type||"html",header:e.header,targetStyles:["*"],style:"@page {margin: 0 10mm};",ignoreElements:e.ignore||[],properties:e.properties||null})},async get_full_print_detail(){this.tableHeader.ListNum=this.listnum;let e={listNum:this.tableHeader.ListNum};console.log(e);try{let t=await(0,m.e_)(e),l=await(0,m.Pt)();const a={OPEN:"未发货",CLOSED:"已发货",PENDING:"部分发货",DISCARDED:"作废"};this.tableHeader.ExstoreType=a[t.listStatus];let r=l.find((e=>e.customerName==t.customer));if(!r)return console.error(`customer not found for customer name: ${t.customer}`),void alert("客户信息未找到！");this.printData.header="出库单--"+t.customer+" ["+r.customerId+"]",this.tableHeader.Customer=t.customer+" ["+r.customerId+"]",this.tableHeader.Date=(new Date).toLocaleDateString(),this.tableData=t.wrapInfoDetails.map((e=>({SupplementID:e.supId,SupplementName:null,WrapSize:e.wrapSize,EnstoreNum:e.expInNum,Boxes:e.boxes,UnloadPlace:e.unloadPlace})));for(let e of this.tableData){let t={supId:e.SupplementID},l=await(0,m.$R)(t);1===l.length?e.SupplementName=l[0].supName:alert("物料信息请求失败！")}}catch(t){console.error("Error fetching print details: ",t)}}}},V=l(1241);const x=(0,V.A)(w,[["render",N]]);var L=x,E={name:"ShipmentMain",components:{PrintItem:L},data(){return{listNum:"",activeTab:"all",customer:"",Visible:!1,item_total:0,currentPage:1,pageSize:5,filters:{customer:"",deliveryNumber:""},tableData:[],filteredData:[]}},watch:{activeTab(){this.search()}},computed:{paginatedData(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredData.slice(e,t)}},mounted(){this.fetchDataAndSearch();const e=/ResizeObserver loop limit exceeded/;window.addEventListener("error",(t=>{e.test(t.message)&&t.stopImmediatePropagation()}))},methods:{async fetchDataAndSearch(){try{await this.get_exstore_list(),this.search()}catch(e){console.error("Error fetching or searching:",e)}},async get_exstore_list(){try{let e={listNum:null,listStatus:null,customer:null},t=await(0,m.c8)(e);console.log("exstore_list",t),t=t.map((e=>({id:e.id,deliveryNumber:e.listNum,deliveryStatus:e.listStatus,customer:e.customer,creator:e.creator,updator:e.updator,createTime:e.createTime,updateTime:e.updateTime})));const l={OPEN:"未发货",CLOSED:"已发货",PENDING:"部分发货",DISCARDED:"作废"};t.forEach((e=>{e.deliveryStatus in l&&(e.deliveryStatus=l[e.deliveryStatus])})),console.log("exstore_list_xiu",t),this.tableData=t,console.log("this.tableData",this.tableData)}catch(e){console.error(e)}},getStatusClass(e){switch(e){case"未发货":return"not-shipped";case"已发货":return"in-transit";case"部分发货":return"partial-storage";case"作废":return"invalid";default:return""}},search(){console.log("搜索条件:",this.filters),console.log("this.tableData",this.tableData);let e=this.tableData;"all"!==this.activeTab&&(e=e.filter((e=>{switch(this.activeTab){case"not-shipped":return"未发货"===e.deliveryStatus;case"in-transit":return"已发货"===e.deliveryStatus;case"partial-storage":return"部分发货"===e.deliveryStatus;case"invalid":return"作废"===e.deliveryStatus;default:return!0}}))),this.filters.customer&&(e=e.filter((e=>e.customer.includes(this.filters.customer)))),this.filters.deliveryNumber&&(e=e.filter((e=>e.deliveryNumber.includes(this.filters.deliveryNumber)))),this.filteredData=e},resetFilters(){this.filters.customer="",this.filters.deliveryNumber="",this.search()},createDeliverOrder(){console.log("创建出库单"),this.$router.push("/move/shipment/ShipmentCreate")},edit(e){"未发货"!==e.deliveryStatus&&console.warn("只有未发货状态的入库单可以编辑"),this.$router.push({name:"ShipmentEdit",query:{DeliveryNum:e.deliveryNumber,customer:e.customer}}),console.log("编辑:",e)},store(e){console.log("出库:",e),this.$router.push({name:"ShipmentDo",query:{DeliveryNum:e.deliveryNumber}})},printOrder(e){console.log("打印出库单:",e),this.Visible=!0,this.listNum=e.deliveryNumber,console.log(this.listNum)},async deleteRow(e){this.tableData=this.tableData.filter((t=>t!==e)),console.log("row.deliveryNumber",e.deliveryNumber);try{let t={listNum:e.deliveryNumber},l=await(0,m.lF)(t);console.log("delete_data",l)}catch(t){console.error(t)}console.log(1111111111),this.search(),console.log("删除:",e)}}};const I=(0,V.A)(E,[["render",p],["__scopeId","data-v-1b40dc50"]]);var P=I}}]);
//# sourceMappingURL=26.ce50b2d3.js.map