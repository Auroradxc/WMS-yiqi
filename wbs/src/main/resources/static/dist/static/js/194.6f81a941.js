"use strict";(self["webpackChunkmenu"]=self["webpackChunkmenu"]||[]).push([[194],{7194:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var l=a(6768);const r={class:"header"};function o(e,t,a,o,n,s){const i=(0,l.g2)("el-input"),u=(0,l.g2)("el-form-item"),p=(0,l.g2)("el-radio-button"),d=(0,l.g2)("el-radio-group"),c=(0,l.g2)("el-option"),h=(0,l.g2)("el-select"),m=(0,l.g2)("el-divider"),g=(0,l.g2)("el-text"),b=(0,l.g2)("el-icon"),f=(0,l.g2)("el-button"),y=(0,l.g2)("AddPartView"),k=(0,l.g2)("el-table-column"),C=(0,l.g2)("el-input-number"),_=(0,l.g2)("el-table"),w=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(w,{model:n.form,"label-width":"120px"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{label:"入库单号"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.form.orderNumber,"onUpdate:modelValue":t[0]||(t[0]=e=>n.form.orderNumber=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,l.bF)(u,{label:"入库类型"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:n.form.entryType,"onUpdate:modelValue":t[1]||(t[1]=e=>n.form.entryType=e)},{default:(0,l.k6)((()=>[(0,l.bF)(p,{label:"采购入库"}),(0,l.bF)(p,{label:"外协入库"}),(0,l.bF)(p,{label:"退货入库"})])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(u,{label:"供应商",required:"",class:"short-input"},{default:(0,l.k6)((()=>[(0,l.bF)(h,{modelValue:n.form.supplier,"onUpdate:modelValue":t[2]||(t[2]=e=>n.form.supplier=e),placeholder:"请选择供应商"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.SupplierList,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e.supplierId,label:e.supplierName,value:e.supplierName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(u,{label:"备注"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{type:"textarea",modelValue:n.form.note,"onUpdate:modelValue":t[3]||(t[3]=e=>n.form.note=e),maxlength:"100","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(m),(0,l.Lk)("div",r,[(0,l.bF)(g,{size:"large",class:"header-text"},{default:(0,l.k6)((()=>[(0,l.eW)("零件明细")])),_:1}),(0,l.bF)(f,{type:"success",plain:"",class:"header-button"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{color:"green"}),(0,l.eW)(" 批量设置仓库/库区 ")])),_:1}),(0,l.bF)(f,{type:"primary",onClick:s.addPart,class:"header-button"},{default:(0,l.k6)((()=>[(0,l.eW)("添加零件")])),_:1},8,["onClick"]),n.Visiable?((0,l.uX)(),(0,l.Wv)(y,{key:0,ref:"dialog",onConfirmParts:s.handleConfirmParts,onClose:t[4]||(t[4]=e=>n.Visiable=!1)},null,8,["onConfirmParts"])):(0,l.Q3)("",!0)]),(0,l.bF)(_,{data:n.form.parts,border:""},{default:(0,l.k6)((()=>[(0,l.bF)(k,{prop:"partNumber",label:"零件号",width:"180",style:{"text-align":"center"}}),(0,l.bF)(k,{label:"入库数量",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(C,{modelValue:e.row.quantity,"onUpdate:modelValue":t=>e.row.quantity=t,min:1,class:"box",onChange:t=>s.handleQuantityChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(k,{label:"箱数",class:"titile",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(C,{modelValue:e.row.boxCount,"onUpdate:modelValue":t=>e.row.boxCount=t,min:1,class:"box",onChange:t=>s.handleBoxCountChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(k,{prop:"waitingPackage",label:"待转包",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(h,{modelValue:e.row.waitingPackage,"onUpdate:modelValue":t=>e.row.waitingPackage=t,placeholder:"请选择",class:"box"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.options,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(k,{prop:"toolCode",label:"器具编码",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(h,{modelValue:e.row.toolCode,"onUpdate:modelValue":t=>e.row.toolCode=t,placeholder:"请选择器具"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.Appliances,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e.wrapId,label:e.wrapId,value:e.wrapId},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(k,{label:"包装容量",width:"180",class:"titile"},{default:(0,l.k6)((e=>[(0,l.bF)(C,{modelValue:e.row.packageSize,"onUpdate:modelValue":t=>e.row.packageSize=t,min:1},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.bF)(k,{label:"操作",class:"titile",width:"180",style:{"text-align":"center"}},{default:(0,l.k6)((e=>[(0,l.bF)(f,{type:"danger",icon:"el-icon-delete",size:"small",onClick:t=>s.removePart(e.$index),style:{"text-align":"center",height:"40px",width:"139px"}},{default:(0,l.k6)((()=>[(0,l.eW)("删除")])),_:2},1032,["onClick"])])),_:1}),(0,l.bF)(k,{prop:"warehouseArea",label:"仓库/库区",width:"180",class:"titile"})])),_:1},8,["data"]),(0,l.bF)(u,{class:"savebutton",style:{"text-align":"center"}},{default:(0,l.k6)((()=>[(0,l.bF)(f,{type:"primary",onClick:s.save,style:{"margin-left":"auto","margin-right":"20px"}},{default:(0,l.k6)((()=>[(0,l.eW)("保存")])),_:1},8,["onClick"]),(0,l.bF)(f,{onClick:s.cancel,style:{"margin-left":"0px","margin-right":"auto"}},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])}a(4114);var n=a(4373),s=a(9161),i={components:{AddPartView:s.A},name:"InstoreCreate",data(){return{Visiable:!1,form:{orderNumber:"",entryType:"采购入库",supplier:"",orderID:"",note:"",parts:[]},SupplierList:[],options:[{value:"true",label:"是"},{value:"false",label:"否"}],Appliances:[]}},created(){this.fetchSupplierList(),this.fetchAppliances(),this.fetchOrderNumber(),this.get_enstorelist_num()},methods:{async fetchSupplierList(){try{const e=await n.A.post("http://97.64.20.181:8000/get_supplier_list",{});e.data&&Array.isArray(e.data)?this.SupplierList=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}},async fetchAppliances(){try{const e=await n.A.post("http://97.64.20.181:8000/request_all_appliances",{});e.data&&Array.isArray(e.data)?this.Appliances=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}console.log(this.Appliances)},async fetchOrderNumber(){let e=await this.get_enstorelist_num();const t=e.Num;console.log(e);const a=new Date,l=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,"0"),o=a.getDate().toString().padStart(2,"0"),n=`R-${l}-${r}-${o}-${t}`;this.form.orderNumber=n},async get_enstorelist_num(){let e;return await n.A.post("http://97.64.20.181:8000/get_new_enstore_num_today").then((t=>{e=t.data})),e},handleToolCodeChange(e){const t=this.Appliances.find((t=>t.wrapId===e.toolCode));t&&(e.packageSize=Math.min(e.packageSize,t.wrapSize))},getMaxPackageSize(e){const t=this.Appliances.find((t=>t.wrapId===e));return t?t.wrapSize:1/0},handleQuantityChange(e){e.packageSize=Math.ceil(e.quantity/e.boxCount)},handleBoxCountChange(e){e.packageSize=Math.ceil(e.quantity/e.boxCount)},addPart(){this.Visiable=!0},handleConfirmParts(e){e.forEach((e=>{this.form.parts.push({partNumber:e.supId,quantity:1,boxCount:"",waitingPackage:"",toolCode:"",packageSize:1,warehouseArea:""})})),this.Visiable=!1},removePart(e){this.form.parts.splice(e,1)},cancel(){this.$router.replace("/move/enter/try/enter")},async save(){let e={sup_id:"",enstore_num:"",wrap_id:"",wrap_size:"",boxes:""},t=[];console.log("Form data:",this.form),console.log("parts:",this.form.parts);for(let r=0;r<this.form.parts.length;r++){if(e.sup_id=this.form.parts[r].partNumber,console.log(this.form.parts[r].partNumber),e.enstore_num=this.form.parts[r].quantity,e.wrap_id=this.form.parts[r].toolCode,console.log(e.wrap_id),console.log(this.form.parts[r].toolCode),e.wrap_size=this.form.parts[r].packageSize,this.form.parts[r].packageSize>this.getMaxPackageSize(this.form.parts[r].toolCode))return alert("超过容量上限 "+this.getMaxPackageSize(this.form.parts[r].toolCode)),void this.removePart(r);e.boxes=this.form.parts[r].boxCount,t.push(Object.assign({},e)),console.log(t)}let a={listNum:this.form.orderNumber,listStatus:"OPEN",supplier:this.form.supplier,wrapInfoDetails:t};console.log(a);try{const e=await n.A.post("http://97.64.20.181:8000/create_enstore_list",a);e.data?console.log(e.data):console.error("Unexpected response data:",e.data)}catch(l){console.error("Error fetching supplier list:",l)}this.$router.replace("/move/enter/try/enter")}}},u=a(1241);const p=(0,u.A)(i,[["render",o],["__scopeId","data-v-14da8067"]]);var d=p},9161:function(e,t,a){a.d(t,{A:function(){return m}});var l=a(6768);const r={class:"inputArea"},o={style:{display:"flex","justify-content":"center"}},n={style:{display:"flex","justify-content":"center","margin-bottom":"20px"}},s={class:"dialog-footer"};function i(e,t,a,i,u,p){const d=(0,l.g2)("el-text"),c=(0,l.g2)("el-input"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-table-column"),g=(0,l.g2)("el-table"),b=(0,l.g2)("el-pagination"),f=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(f,{modelValue:u.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>u.dialogVisible=e),title:"添加零件",width:"60%"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",r,[(0,l.bF)(d,{class:"inputTitle",tag:"b"},{default:(0,l.k6)((()=>[(0,l.eW)("供应商")])),_:1}),(0,l.bF)(c,{modelValue:u.query.supplier,"onUpdate:modelValue":t[0]||(t[0]=e=>u.query.supplier=e),placeholder:"代码",class:"filter-input",clearable:"",autosize:"",type:"textarea",onClear:p.handleClear,onInput:p.handleInput},null,8,["modelValue","onClear","onInput"]),(0,l.bF)(d,{class:"inputTitle",tag:"b"},{default:(0,l.k6)((()=>[(0,l.eW)("零件号")])),_:1}),(0,l.bF)(c,{modelValue:u.query.supId,"onUpdate:modelValue":t[1]||(t[1]=e=>u.query.supId=e),placeholder:"批量查询",class:"filter-input",clearable:"",autosize:"",type:"textarea",onClear:p.handleClear,onInput:p.handleInput},null,8,["modelValue","onClear","onInput"]),(0,l.bF)(h,{type:"primary",onClick:p.handleQuery},{default:(0,l.k6)((()=>[(0,l.eW)("查询")])),_:1},8,["onClick"])]),(0,l.Lk)("div",o,[(0,l.bF)(g,{data:p.filteredData,border:"",style:{width:"70%","margin-bottom":"20px"},onSelectionChange:p.handleSelectionChange},{default:(0,l.k6)((()=>[(0,l.bF)(m,{type:"selection",width:"70"}),(0,l.bF)(m,{prop:"supName",label:"零件名称"}),(0,l.bF)(m,{prop:"supId",label:"零件编号"}),(0,l.bF)(m,{prop:"supplier",label:"供应商"})])),_:1},8,["data","onSelectionChange"])]),(0,l.Lk)("div",n,[(0,l.bF)(b,{background:"",layout:"prev, pager, next",total:u.total,"page-size":u.pageSize,onCurrentChange:p.handlePageChange},null,8,["total","page-size","onCurrentChange"])]),(0,l.Lk)("span",s,[(0,l.Lk)("div",null,[(0,l.RG)(e.$slots,"footer",{},void 0,!0)]),(0,l.bF)(h,{onClick:t[2]||(t[2]=e=>u.dialogVisible=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:p.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:3},8,["modelValue"])}var u=a(4373),p=a(1620),d={name:"AddPartView",data(){return{dialogVisible:!0,supplier:null,query:{supplier:"",supId:""},selectedParts:[],parts:[],currentPage:1,pageSize:10,total:0}},created(){this.fetchSupplementList()},computed:{filteredData(){const e=Array.isArray(this.parts)?this.parts:[];return this.query?e.filter((e=>e.supId&&e.supId.includes(this.query.supId)&&e.supplier&&e.supplier.includes(this.query.supplier))):e.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)}},watch:{parts(e){this.total=Array.isArray(e)?e.length:0}},methods:{handleClear(){this.query="",this.currentPage=1},handleInput(){this.currentPage=1},handleQuery(){this.currentPage=1,this.get_supplement_list_filtered()},handleSelectionChange(e){this.selectedParts=e},handlePageChange(e){this.currentPage=e},handleConfirm(){this.$emit("confirmParts",this.selectedParts),this.dialogVisible=!1,console.log(this.selectedParts)},async get_supplement_list_filtered(){let e={supId:this.query.supId||null,supplier:this.query.supplier||null};try{const t=await(0,p.aM)(e);Array.isArray(t)?this.parts=t:console.error("Unexpected response data:",t)}catch(t){console.error("Error fetching filtered list:",t)}},async fetchSupplementList(){try{const e=await u.A.post("http://97.64.20.181:8000/request_supplement_list",{supId:null,supplier:null});e.data&&Array.isArray(e.data)?this.parts=e.data:console.error("Unexpected response data:",e.data)}catch(e){console.error("Error fetching supplier list:",e)}}},mounted(){this.total=Array.isArray(this.parts)?this.parts.length:0,this.get_supplement_list_filtered()}},c=a(1241);const h=(0,c.A)(d,[["render",i],["__scopeId","data-v-07232d6c"]]);var m=h}}]);
//# sourceMappingURL=194.6f81a941.js.map